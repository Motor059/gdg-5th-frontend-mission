# 쿠키, 토큰, 세션 기본 개념

---

## 쿠키와 세션의 등장 배경
- HTTP 통신의 **무상태(Stateless)**, **비연결성(Connectionless)** 특징으로 인해 상태 유지가 되지 않는 문제를 해결하기 위해 등장

* **`HTTP의 근본적인 문제`**
    - **비연결성 (Connectionless)**: 효율성을 위해 요청과 응답이 끝나면 연결을 끊음
    - **무상태 (Stateless)**: 서버가 클라이언트의 이전 상태를 전혀 기억하지 못함

---

## 1단계 해결책: 쿠키 (출입증)
- 클라이언트(브라우저) 쪽에 정보를 저장하여 서버에 요청할 때마다 꼬리표처럼 보여주는 방식

* **`동작 방식`**
    - 서버가 응답 헤더(`Set-Cookie`)에 정보를 담아 보냄
    - 클라이언트는 이후 요청 시마다 요청 헤더(`Cookie`)에 저장된 쿠키를 담아 보냄

* **`단점`**
    - 사용자의 컴퓨터에 저장되므로 위변조가 쉽고 보안에 취약함

---

## 2단계 해결책: 세션 (사물함)
- 쿠키의 보안 취약점을 해결하기 위해 중요한 정보는 서버가 직접 관리하는 방식

* **`동작 방식`**
    - **중요한 정보**: 서버의 DB(사물함)에 저장
    - **사용자**: 접근할 수 있는 열쇠(Session ID)만 가짐
    - **전달**: 열쇠는 보통 쿠키에 담아서 주고받음

* **`치명적 단점`**
    - **확장성(Scalability) 문제**: 서버가 여러 대일 때 세션 동기화 문제 발생
    - **모바일 앱 환경**: 웹 브라우저 쿠키 기반이라 앱에서 다루기 까다로움

---

## 토큰 (Token) & JWT
- 세션의 한계를 극복하기 위해 등장한 **'위조 방지 도장이 찍힌 여권'** 개념임

### 세션 vs 토큰
* **`세션`**: 사용자 정보가 **서버(DB)**에 있음 (확인 시 DB 조회 필요)
* **`토큰`**: 사용자 정보를 암호화해서 **사용자**에게 건네줌 (서버는 저장 안 함, 서명만 확인)

### JWT (JSON Web Token) 핵심 구조
- 토큰은 `.`으로 구분된 세 파트(Header, Payload, Signature)로 구성됨

1) **Header**
    - 검증에 필요한 메타 데이터 (설명서 역할)
    - `alg`: 서명 알고리즘 (HS256 등)
    - `typ`: 토큰 유형 (JWT)

2) **Payload**
    - 실제 전달하려는 데이터(Claim set)가 담긴 곳 (ID, 권한, 만료시간 등)
    - **주의**: 암호화가 아닌 인코딩(Base64)만 된 상태라 민감한 정보(비번 등)는 절대 금지

3) **Signature**
    - 위변조를 막는 핵심 장치
    - `Header` + `Payload` + `서버 비밀키`를 조합하여 암호화한 값
    - 서버는 이 서명을 다시 계산해보고 일치 여부로 위조를 판별함

---

## JWT 장단점

* **`장점`**
    - **확장성 & Stateless**: 서버가 정보를 저장하지 않아 서버 부하가 적고 분산 처리에 용이함
    - **Self-Contained**: 토큰 자체에 인증 정보가 있어 DB 조회가 필요 없음
    - **모바일 친화적**: 쿠키 없이 HTTP 헤더에 담아 전송 가능

* **`단점`**
    - **길이 문제**: Payload 정보가 많으면 토큰이 길어져 네트워크 부하 증가
    - **강제 만료 불가**: 한 번 발급되면 탈취당해도 서버에서 만료시키기 어려움
    - **정보 노출**: Payload는 디코딩이 쉬워 중요 정보 저장 불가

---

## 보안 전략: Refresh Token & Sliding Session
- JWT의 '탈취 시 대처가 어렵다'는 단점을 보완하기 위한 방법

### Access Token & Refresh Token
- **`Access Token`**: 실제 자원 요청용. 만료 시간을 매우 짧게 설정하여 탈취 피해 최소화
- **`Refresh Token`**: Access Token 재발급용 열쇠. 만료 기간을 길게 설정하고 DB에 저장하여 비교 검증

### Sliding Session
- 사용자가 서비스를 활발히 이용 중(요청 발생)이면 만료 시간을 자동으로 연장해주는 방식
- **`효과`**: 사용자 편의성 증대 및 보안성 유지 (방치 시 자동 만료)

---

## 참고 문헌
- https://velog.io/@jung5318/쿠키-세션-토큰의-차이점